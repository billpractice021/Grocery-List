<!DOCTYPE html>
<html>
    <head>
	    <title>Groceries List</title>
	    <link rel="stylesheet" type="text/css" href="style.css">
	    <link rel="stylesheet" type="text/css" href="groceries.css">
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </head>
    <body class="groceries">
        <h1>Grocery List</h1>

        <div>
            <ul>
                <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
                <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.22">Frisbee $5.22</a></li>
            </ul>

            <button id="clear-cart">Clear Cart</button?>
        </div>

        <div>
            <ul id="show-cart">
                <li>??????</li>
            </ul>
            <div>You have <span id="count-cart">X</span> items in your cart</div>
            <div>Total Cart:$<span id="total-cart"></span></div>
        </div>  

        
        <script>
            
        $(".add-to-cart").click(function(event){
            event.preventDefault(); 
            var name  = $(this).attr("data-name"); 
            var price = Number($(this).attr("data-price"));

            BM_shoppingCart.addItemToCart(name, price, 1);
            displayCart(); 
        }); 

        $("#clear-cart").click(function(event) {
            BM_shoppingCart.clearCart();
            displayCart();  
        });
        
        function displayCart() {
            var cartArray = BM_shoppingCart.listCart();
            var output = "";  
            for (var i in cartArray) {
                output += "<li>" 
                    +cartArray[i].name 
                    +" <input class='item-count' type='number' data-name='" 
                    +cartArray[i].name 
                    +"' value='"+cartArray[i].count+"' >" 
                    +" x "+cartArray[i].price 
                    +" = "+cartArray[i].total 
                    +"<button class='plus-item' data-name='" 
                    +cartArray[i].name+"'>+</button>" 
                    +"<button class='subtract-item' data-name='" 
                    +cartArray[i].name+"'>-</button>" 
                    +"<button class='delete-item' data-name='" 
                    +cartArray[i].name+"'>X</button>" 
                    +"</li>";
            }
            $("#show-cart").html(output);
            $("#count-cart").html(BM_shoppingCart.countCart()); 
            $("#total-cart").html(BM_shoppingCart.totalCart());
            
        }
        
        $("#show-cart").on("click", ".delete-item", function(event) {
            var name = $(this).attr("data-name");
            BM_shoppingCart.removeItemFromCartAll(name);
            displayCart(); 
        }); 

        $("#show-cart").on("click", ".subtract-item", function(event){
            var name = $(this).attr("data-name"); 
            BM_shoppingCart.removeItemFromCart(name);
            displayCart();  
        });

        $("#show-cart").on("click", ".plus-item", function(event) {
            var name = $(this).attr("data-name"); 
            BM_shoppingCart.addItemToCart(name, 0, 1);
            displayCart();  
        });

        $("#show-cart").on("change", ".item-count", function(event) {
            var name = $(this).attr("data-name");
            var count = Number($(this).val());
            BM_shoppingCart.setCountForItem(name, count);
            displayCart();  
        });



        
        // **********************************************
        // Shopping Cart functions

        var BM_shoppingCart = {};
        
        BM_shoppingCart.cart = []; 
        
       
        BM_shoppingCart.Item = function(name, price, count) {
            this.name = name;
            this.price = price;
            this.count = count;
        };
        
        
        BM_shoppingCart.addItemToCart = function(name, price, count) {
            for (var i in this.cart) {
                if (this.cart[i].name === name) {
                    this.cart[i].count += count;
                    this.saveCart(); // Fixed mistake 
                    return; 
                }
            }
            var item  = new this.Item(name, price, count);
            this.cart.push(item);
            this.saveCart();  
        };


        BM_shoppingCart.setCountForItem = function(name, count) {
            for (var i in this.cart) {
                if (this.cart[i].name === name) {
                    this.cart[i].count = count; 
                    break;
                }
            }
            this.saveCart(); 
        }; 


        BM_shoppingCart.removeItemFromCart = function(name) { // Removes one particular item from a cart
            for (var i in this.cart) {
                if (this.cart[i].name === name) {
                    this.cart[i].count--; //cart[i].count = cart[i].count = cart[i].count -1 (same thing)
                    if (this.cart[i].count === 0) {
                        this.cart.splice(i, 1); //can also call removeItemFromCartAll(); here so that you don't duplicate code
                    }
                    break; 
                }
            }
            this.saveCart(); 
        };


        BM_shoppingCart.removeItemFromCartAll = function(name) {  // Removes all item name (a particular item)
            for (var i in this.cart) {
                if (this.cart[i].name === name) {
                    this.cart.splice(i, 1); 
                    break;
                }
            }
            this.saveCart(); 
        }; 
        

        BM_shoppingCart.clearCart = function() {  // clears cart
            this.cart = [];
            this.saveCart();  
        }; 

        // clearCart(); 
        // console.log(cart);       

        
        BM_shoppingCart.countCart = function() { // return total count
            var totalCount = 0; 
            for (var i in this.cart) {
                totalCount += this.cart[i].count
            }
            return totalCount; 
        }
        
        // console.log(countCart());  

            
        
        BM_shoppingCart.totalCart = function() {  // return total cost
            var totalCost = 0;
            for (var i in this.cart) {
                totalCost += this.cart[i].price * this.cart[i].count;
            }
            return totalCost.toFixed(2);
        }; 

        // console.log(totalCart());  
        

        BM_shoppingCart.listCart = function() {  // returns array of all Items
            var cartCopy = [];
            for (var i in this.cart) {
                var item = this.cart[i]; 
                var itemCopy = {};
                for (var p in item) {
                    itemCopy[p] = item[p];
                }
                itemCopy.total = (item.price * item.count).toFixed(2); 
                cartCopy.push(itemCopy); 
            } 
            return cartCopy;
            // Can't do return cart; or return cart.slice(); Rememeber arrays and objects are always a reference. 
        };
            
            
        
        BM_shoppingCart.saveCart = function() {  // saves cart to local storage
            localStorage.setItem("shoppingCart", JSON.stringify(this.cart)); //converts arrays/obj's into a json string
        };
            

        
        BM_shoppingCart.loadCart = function() {  // loads saved cart in local storage
            this.cart = JSON.parse(localStorage.getItem("shoppingCart"));
        }; 

        BM_shoppingCart.loadCart(); 
        displayCart();

        console.log("Shopping Cart: Cart");
        console.log(BM_shoppingCart.cart);
        // console.log("Global Cart:");
        // console.log(cart);   
            
        </script>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </body>
</html>