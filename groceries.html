<!DOCTYPE html>
<html>
    <head>
	    <title>Groceries List</title>
	    <link rel="stylesheet" type="text/css" href="style.css">
	    <link rel="stylesheet" type="text/css" href="groceries.css">
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </head>
    <body class="groceries">
        <h1>Grocery List</h1>

        <div>
            <ul>
                <li><a class="add-to-cart" href="#" data-name="Apple" data-price="1.22">Apple $1.22</a></li>
                <li><a class="add-to-cart" href="#" data-name="Banana" data-price="1.33">Banana $1.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Shoe" data-price="22.33">Shoe $22.33</a></li>
                <li><a class="add-to-cart" href="#" data-name="Frisbee" data-price="5.22">Frisbee $5.22</a></li>
            </ul>

            <button id="clear-cart">Clear Cart</button?>
        </div>

        <div>
            <ul id="show-cart">
                
            </ul>
        </div>

        
        <script>

        $(".add-to-cart").click(function(event){
            event.preventDefault(); 
            var name  = $(this).attr("data-name"); 
            var price = Number($(this).attr("data-price"));

            addItemToCart(name, price, 1);
            displayCart(); 
        }); 
        
        function displayCart() {
            console.log("*** Display Cart ***");
            var cartArray = listCart();
            console.log("*** Count Cart: " + cartArray.length);
            
            var output = "";  
            for (var i in cartArray) {
                output += "<li>" + cartArray[i].name + " " + cartArray[i].count + "</li>"
            }
            $("#show-cart").html(output);
        }


        
        // **********************************************
        // Shopping Cart functions



            var cart = []; 
            var Item = function(name, price, count) {
                this.name = name;
                this.price = price;
                this.count = count;
            }; 

            function addItemToCart(name, price, count) {
                for (var i in cart) {
                    if (cart[i].name === name) {
                        cart[i].count += count;
                        return; 
                    }
                 }
                var item  = new Item(name, price, count);
                cart.push(item);
                saveCart();  
            } 

            
            function removeItemFromCart(name) { // Removes one particular item from a cart
                for (var i in cart) {
                    if (cart[i].name === name) {
                        cart[i].count--; //cart[i].count = cart[i].count = cart[i].count -1 (same thing)
                        if (cart[i].count === 0) {
                            cart.splice(i, 1); //can also call removeItemFromCartAll(); here so that you don't duplicate code
                        }
                        break; 
                    }
                }
                saveCart(); 
            }


        
            function removeItemFromCartAll(name) {  // Removes all item name (a particular item)
                for (var i in cart) {
                    if (cart[i].name === name) {
                        cart.splice(i, 1); 
                        break;
                    }
                }
                saveCart(); 
            } 
            

            function clearCart() {  // clears cart
                cart = [];
                saveCart();  
            } 

            // clearCart(); 
            // console.log(cart);

            
            function countCart() { // return total count
                var totalCount = 0; 
                for (var i in cart) {
                    totalCount += cart[i].count
                }
                return totalCount; 
            }
            
            // console.log(countCart());

            
            function totalCart() {  // return total cost
                var totalCost = 0;
                for (var i in cart) {
                    totalCost += cart[i].price;
                }
                return totalCost;
            } 

            // console.log(totalCart());

            
            function listCart() {  // returns array of all Items
                var cartCopy = [];
                for (var i in cart) {
                    var item = cart[i]; 
                    var itemCopy = {};
                    for (var p in item) {
                        itemCopy[p] = item[p];
                    }
                    cartCopy.push(itemCopy); 
                } 
                return cartCopy;
                // Can't do return cart; or return cart.slice(); Rememeber arrays and objects are always a reference. 
            } 


            /*var a = ["A", "B", "C"];
            var b = a.slice(); the slice method without any parameters will create a copy of var a (new array 2 seperate arrays). Same concept applies to objects except you can't use slice that applies to arrays.. 
            b.push("D"); 
            console.log(a);
            console.log(b);*/  //This is why we don't do return cart; in listCart(); 

            function saveCart() {  // saves cart to local storage
                localStorage.setItem("shoppingCart", JSON.stringify(cart)); //converts arrays/obj's into a json string
            } 

            
            function loadCart() {  // loads saved cart in local storage
                cart = JSON.parse(localStorage.getItem("shoppingCart"));
            } 

            loadCart();
            displayCart(); 

            var array = listCart(); 
            console.log("-----------------");
            console.log(array); 

        </script>
        <script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
    </body>
</html>